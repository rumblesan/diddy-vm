<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <title>Diddy-VM by rumblesan</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

  </head>

  <body>
    <div class="wrapper">

      <header>
        <h1>Diddy-VM</h1>
        <p>Learning about Virtual Machines by coding Virtual Machines</p>

        <p class="view">
            <a href="https://github.com/rumblesan/diddy-vm">
                View the Project on GitHub <small>rumblesan/diddy-vm</small>
            </a>
        </p>

        <ul>
          <li><a href="https://github.com/rumblesan/diddy-vm/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/rumblesan/diddy-vm/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/rumblesan/diddy-vm">View On <strong>GitHub</strong></a></li>
        </ul>

      </header>

      <section>
<h1 id='diddy_vm'>Diddy VM</h1>

<h2 id='about'>About</h2>

<p>The Diddy VM is a project so I can learn more about writing virtual machines. It&#8217;s not necessarily going to be the greatest piece of code ever but hopefully it should teach me a bunch of stuff.</p>

<p>The project is named after everybodies favorite rap star P Diddy. Little known fact, <strong>Diddy Loves Computer Science!</strong></p>

<p><img alt='Diddy-VM' src='http://rumblesan.github.com/diddy-vm/img/diddy.jpg' /></p>

<h2 id='aim'>Aim</h2>

<p>The Diddy VM is very simple and has implementations in Python and C called, respectively, P-Diddy and C-Diddy. (Honestly I didn&#8217;t start this with that pun in mind, it just happened.) There is a basic assembler to make writing code at such a low level a bit easier and I&#8217;m gradually creating a compiler for an as yet un-finalised language.</p>

<h2 id='architecture'>Architecture</h2>

<p>The Diddy VM has no registers and no stack so all operations happen entirely in memory. The memory size is arbitrarily 2^12 elements. In Python this uses a list so value size isn&#8217;t an issue. In C this is an array of integers so a little bit more care must be taken. The VM uses an positional counter to keep track of where the execution is currently happening.</p>

<p>The instructions all take up multiple memory entries, for example, the <strong>Copy</strong> instruction takes two arguments, where the data is being copied from and where it&#8217;s being copied to. In memory this means that one memory slot is taken up by the instruction, the next by the source address and the next by the destination address. It&#8217;s not very efficient but it&#8217;s simple to implement and makes things a bit more understandable I feel.</p>

<p>The VM program is split into two sections. VMBase sets up the RAM and the general machine methods such as setting/getting values in RAM and keeping track of the position counter. The DVM class extends this and just contains the methods for the VM instructions. In Python these are two separate classes. In C the VMBase is a struct and function library with the instructions being further functions that operate on it.</p>

<p>There are fairly comprehensive unit tests for the Python classes. To run them, cd to the dvm folder then run the class files. The test suits themselves are in the tests folder. There aren&#8217;t tests for the C yet, it&#8217;s on the TODO list.</p>

<h3 id='instructions'>Instructions</h3>

<p>The VM has 11 instructions currently :-</p>

<ul>
<li>NOP</li>

<li>Copy</li>

<li>Jump</li>

<li>Branch</li>

<li>Equal</li>

<li>Greater Than</li>

<li>Less Than</li>

<li>Add</li>

<li>Subtract</li>

<li>Output</li>

<li>Halt</li>
</ul>

<p>All arguments to instructions are actually addresses to other points in memory. It&#8217;s probablly going to lead to some spaghetti code but it&#8217;s consistant at least.</p>

<h4 id='nop'>NOP</h4>

<p>NOP takes no instructions and just increments the position counter.</p>

<h4 id='copy'>Copy</h4>

<p>Takes two argument, a source address <strong>A</strong> and a destination address <strong>B</strong>. Copies the data from <strong>A</strong> to <strong>B</strong>.</p>

<h4 id='jump'>Jump</h4>

<p>Takes one argument, a source address <strong>A</strong>. Sets the position counter to the value at <strong>A</strong>.</p>

<h4 id='branch'>Branch</h4>

<p>Takes three arguments, a source address <strong>A</strong> and two destination addresses, <strong>B</strong> and <strong>C</strong>. If the value at <strong>A</strong> is not 0 then the position counter is set to address <strong>B</strong>, otherwise it&#8217;s set to address <strong>C</strong>.</p>

<h4 id='equal'>Equal</h4>

<p>Takes three arguments, two source addresses <strong>A</strong> and <strong>B</strong> and two a destination address <strong>C</strong>. If the values at <strong>A</strong> and <strong>B</strong> are equal then the memory position at address <strong>C</strong> is set to 1, otherwise it&#8217;s set to 0.</p>

<h4 id='greater_than'>Greater Than</h4>

<p>Takes three arguments, two source addresses <strong>A</strong> and <strong>B</strong> and two a destination address <strong>C</strong>. If the value at <strong>A</strong> is greater than <strong>B</strong> then the memory position at address <strong>C</strong> is set to 1, otherwise it&#8217;s set to 0.</p>

<h4 id='less_than'>Less Than</h4>

<p>Takes three arguments, two source addresses <strong>A</strong> and <strong>B</strong> and a destination address <strong>C</strong>. If the value at <strong>A</strong> is less than <strong>B</strong> then the memory position at address <strong>C</strong> is set to 1, otherwise it&#8217;s set to 0.</p>

<h4 id='add'>Add</h4>

<p>Takes three arguments, two source addresses <strong>A</strong> and <strong>B</strong> and a destination address <strong>C</strong>. Adds the value at <strong>A</strong> to the value at <strong>B</strong> and writes the result to <strong>C</strong>.</p>

<h4 id='subtract'>Subtract</h4>

<p>Takes three arguments, two source addresses <strong>A</strong> and <strong>B</strong> and a destination address <strong>C</strong>. Subtracts the value at <strong>B</strong> from the value at <strong>A</strong> and writes the result to <strong>C</strong>.</p>

<h4 id='output'>Output</h4>

<p>Takes one argument, a source address <strong>A</strong>. Writes the value at <strong>A</strong> to the screen, the number is converted into an ascii character.</p>

<h4 id='halt'>Halt</h4>

<p>Takes one argument, a source address <strong>A</strong>. Stops the VM and sets the status to the value at address <strong>A</strong>.</p>

<h2 id='writing_programs'>Writing Programs</h2>

<p>There is an assembler that will convert fairly low level machine code into the binary integer data that gets loaded into the VM memory. This can deal with labels to make addressing easier and will also substitute instruction names. As well as that it will strip out comments and white space so programs can be more easily written. The example helloworld program is in the programs folder. This needs to be run through the assembler, which takes the path to the file as it&#8217;s only argument. The assembled program is written out to the <strong>compiled</strong> folder.</p>

<h2 id='running_programs'>Running Programs</h2>

<p>To run a program in the P-Diddy VM, use the diddy.py script and pass the path to the assembled program file as the only argument. To run it on C-Diddy you need to first compile it and then pass in the assembled program with the -i flag (Inconsistent I know, blame my C skills)</p>

<h2 id='future'>Future</h2>

<p>There are a few things I want to do with the base VM in future, other than fix all the small niggly problems.</p>

<ul>
<li>Have single element instructions</li>

<li>Rely less on spaghetti &#8220;everything a pointer&#8221; style</li>

<li>Add the ability to have some user input loaded</li>
</ul>

<h2 id='info'>Info</h2>

<p>There is a suite of unit tests for the VM which are fairly comprehensive. If you want to contribute, make sure they all stay running.</p>

<h2 id='contact'>Contact</h2>

<p>guy@rumblesan.com if you have any questions</p>
</section>


      <footer>
        <p>This project is maintained by <a href="https://github.com/rumblesan">rumblesan</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Based on a theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>

    <script src="javascripts/scale.fix.js"></script>
    <script type="text/javascript">
        var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
        document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
        try {
            var pageTracker = _gat._getTracker("UA-19842221-1");
        pageTracker._trackPageview();
        } catch(err) {}
    </script>

  </body>
</html>
